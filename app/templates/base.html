<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gene's Camellias — Cultivar Database</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=2">
</head>
<body>
    <header>
        <div class="header-inner">
            <h1><a href="/">Gene's Camellias</a></h1>
            <nav>
                {% if view == 'list' %}
                    <span class="zoom-control">
                        Zoom:
                        <button id="zoom-down" class="btn btn-sm btn-outline zoom-btn">−</button>
                        <span id="zoom-value">100%</span>
                        <button id="zoom-up" class="btn btn-sm btn-outline zoom-btn">+</button>
                    </span>
                {% endif %}
                {% if view != 'list' %}
                    <a href="{{ url_for('main.cultivar_list') }}" class="btn btn-sm btn-outline">List</a>
                {% endif %}
                {% if view != 'summary' %}
                    <a href="{{ url_for('main.summary_view') }}" class="btn btn-sm btn-outline">Summary</a>
                {% endif %}
                {% if view == 'list' or view == 'summary' %}
                    <a href="{{ url_for('main.table_view') }}" class="btn btn-sm btn-outline">Full</a>
                {% endif %}
                {% if authenticated %}
                    <a href="{{ url_for('main.export_csv') }}" class="btn btn-sm">Export CSV</a>
                    <form method="post" action="{{ url_for('main.logout') }}" class="inline">
                        <button type="submit" class="btn btn-sm btn-outline">Logout</button>
                    </form>
                {% else %}
                    <button id="login-toggle" class="btn btn-sm btn-outline">Login</button>
                {% endif %}
            </nav>
        </div>
    </header>
    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
            <div class="flash flash-{{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>
    <script>
    (function() {
        var display = document.getElementById('zoom-value');
        if (!display) return;

        var KEY = 'genes-zoom';
        var step = 5;
        var min = 50;
        var max = 200;
        var zoom = parseInt(sessionStorage.getItem(KEY)) || 100;
        var main = document.querySelector('main');

        function apply() {
            main.style.zoom = (zoom / 100);
            display.textContent = zoom + '%';
            sessionStorage.setItem(KEY, zoom);
        }

        apply();

        document.getElementById('zoom-down').addEventListener('click', function() {
            zoom = Math.max(min, zoom - step);
            apply();
        });
        document.getElementById('zoom-up').addEventListener('click', function() {
            zoom = Math.min(max, zoom + step);
            apply();
        });
    })();
    </script>
    {% if not authenticated %}
    <div id="login-modal" class="modal-overlay hidden">
        <div class="modal-box">
            <button id="modal-close" class="modal-close">&times;</button>
            <h3>Login</h3>
            <form method="post" action="{{ url_for('main.login') }}" id="login-form">
                <input type="password" name="password" placeholder="Password" required autofocus>
                <button type="submit" class="btn">Go</button>
            </form>
        </div>
    </div>
    <script>
    (function() {
        var modal = document.getElementById('login-modal');
        var pwInput = modal.querySelector('input[type="password"]');
        function open() { modal.classList.remove('hidden'); pwInput.focus(); }
        function close() { modal.classList.add('hidden'); }
        document.getElementById('login-toggle').addEventListener('click', open);
        document.getElementById('modal-close').addEventListener('click', close);
        modal.addEventListener('click', function(e) { if (e.target === modal) close(); });
        document.addEventListener('keydown', function(e) { if (e.key === 'Escape') close(); });
    })();
    </script>
    {% endif %}
    {% block scripts %}{% endblock %}
</body>
</html>
